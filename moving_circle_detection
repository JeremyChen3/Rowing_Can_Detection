import cv2 as cv
import numpy as np
import sys

# Main Algorithm
def apply_processing(frame):
	src = cv.IMREAD_COLOR(frame)

	# Preprocess for HoughCircles
	gray = cv.cvtColor(src, cv.COLOR_BGR2GRAY)
	gray = cv.GaussianBlur(gray, (9, 9), 2)

	rows = gray.shape[0]
	min_radius = int(rows * 0.25)
	max_radius = int(rows * 0.60)

	# Circle Detection
	circles = cv.HoughCircles(
	gray,
        cv.HOUGH_GRADIENT,
        dp = 1,
	minDist = rows,

	# Canny Threshold
	param1=120,  
        param2=40,
        minRadius=min_radius,
        maxRadius=max_radius
	)
	
	# Convert datas collected to nearest integer
	circles = np.round(circles[0]).astype(int)

	# Choose the largest circle
	x, y, r = max(circles, key=lambda c: c[2])
	center = (x, y)
	output = src.copy()
	cv.circle(output, center, r, (0, 255, 67), 7)
	cv.circle(output, center, 4, (0, 255, 67), 5)
	return output	

def read_and_process_video(video_path):
	video_path = 'rowing_can.mp4' 
	cap = cv.VideoCapture(video_path)
	if cap.isOpened() == False:
		print("Error: Could not open video source")
		exit()
	
	while cap.isOpened():
		ret, frame = cap.read()
		if ret:
        		cv.imshow("Frame Window", frame)
        		cv.waitKey(0)
	
	cap.release()
	cv.destryAllWIndows()

read_and_process_video('rowing_can.mp4')
